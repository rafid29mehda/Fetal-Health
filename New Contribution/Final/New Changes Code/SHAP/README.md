Let’s craft the "SHAP Analysis and Feature Selection" section for your Q1 journal paper, incorporating the SHAP summary plots for the three fetal health classes (Normal, Suspect, Pathological), justifying the use of LightGBM with references, and providing a clinically relevant explanation for feature importance and the decision to drop the least performing 11 features. This section will align with the high standards of a Q1 journal, focusing on interpretability, scientific rigor, and clinical relevance.

---

### 3.2.3 SHAP Analysis and Feature Selection

#### 3.2.3.1 Importance and Benefits of SHAP Analysis
SHAP (SHapley Additive exPlanations) analysis is a powerful interpretability framework rooted in game theory, designed to explain the predictions of machine learning models by assigning each feature an importance value for a given prediction. Unlike traditional feature importance methods such as Gini Importance or Permutation Importance, which provide global metrics based on split frequency or performance degradation, SHAP offers instance-level insights, capturing the directional impact (positive or negative) of each feature on model output. This granularity is particularly valuable in healthcare applications, where understanding the precise contribution of clinical variables to predictions can guide decision-making and improve trust in automated systems. In the context of fetal health classification using cardiotocography (CTG) data, SHAP analysis enables the identification of features that most strongly influence the prediction of Normal, Suspect, and Pathological states, aligning model outputs with clinical expectations. Moreover, SHAP’s ability to reveal non-linear relationships and feature interactions provides deeper insights into the model’s decision-making process, facilitating the selection of clinically relevant features and enhancing the model’s interpretability for obstetricians.

#### 3.2.3.2 Selection of LightGBM for Fetal Health Classification
The LightGBM model was selected for this study due to its superior performance in classifying fetal health using CTG data, as demonstrated in prior research and validated by the experimental results in this work. Rahmayanti et al. (2022) reported that LightGBM outperformed other algorithms, including XGBoost, SVM, KNN, Random Forest, ANN, and LSTM, achieving an accuracy of 0.99, F1-Score of 0.99, and AUC of 0.99 across multiple preprocessing scenarios [1]. This aligns with the findings of Ke et al. (2017), who introduced LightGBM as a highly efficient gradient boosting framework optimized for speed and scalability, particularly on datasets with categorical and histogram-based features [2]. CTG data inherently contains histogram-based features such as `histogram_mean`, `histogram_mode`, and `histogram_variance`, which describe the distribution of fetal heart rate (FHR) measurements. LightGBM’s histogram-based learning approach bins continuous features into discrete histograms, reducing memory usage and accelerating training, making it well-suited for CTG data. Additionally, LightGBM’s support for categorical features and its ability to handle imbalanced datasets—through techniques like SMOTE, as applied in this study—further enhance its applicability to the fetal health classification task. The model’s robustness to multicollinearity, as noted in Section 4 of Rahmayanti et al. (2022), also ensures reliable performance even with correlated CTG features like `histogram_mean` and `histogram_median` [1].

#### 3.2.3.3 SHAP Summary Plots for Fetal Health Classes
SHAP summary plots were generated to visualize the impact of each feature on the LightGBM model’s predictions for the Normal, Suspect, and Pathological classes, using the training dataset (3964 samples after SMOTE). These plots, shown in Figures 1a–c, display the features ranked by their mean absolute SHAP values, with each point representing an instance where the feature’s value (color-coded: blue for low, red for high) impacts the prediction (X-axis: SHAP value). Positive SHAP values increase the likelihood of the predicted class, while negative values decrease it.

**Figure 1a: SHAP Summary Plot for Normal Class** reveals that `accelerations` and `abnormal_short_term_variability` are the top contributors. High values of `accelerations` (red) correspond to negative SHAP values (up to -5), reducing the likelihood of the Normal class, as frequent accelerations may indicate fetal reactivity often associated with Suspect or Pathological states. Conversely, low `abnormal_short_term_variability` (blue) increases the likelihood of the Normal class (SHAP values up to 5), reflecting stable FHR variability typical of healthy fetuses. Features like `prolongued_decelerations` and `histogram_mean` also play significant roles, with low values favoring the Normal class, consistent with clinical expectations of minimal decelerations and stable FHR in healthy fetuses.

**Figure 1b: SHAP Summary Plot for Suspect Class** highlights `percentage_of_time_with_abnormal_long_term_variability` and `accelerations` as key drivers. High values of `percentage_of_time_with_abnormal_long_term_variability` (red) result in positive SHAP values (up to 2.5), increasing the likelihood of the Suspect class, as prolonged abnormal variability signals potential fetal distress. Similarly, high `accelerations` (red) push toward the Suspect class, reflecting fetal reactivity that may indicate early stress. Features like `abnormal_short_term_variability` and `mean_value_of_short_term_variability` also contribute, with high values suggesting variability patterns that obstetricians associate with the Suspect state, often warranting closer monitoring.

**Figure 1c: SHAP Summary Plot for Pathological Class** identifies `histogram_mean`, `abnormal_short_term_variability`, and `prolongued_decelerations` as the most influential features. High `histogram_mean` values (red) result in large positive SHAP values (up to 5), strongly increasing the likelihood of the Pathological class, as elevated mean FHR is a known marker of fetal distress. Similarly, high `abnormal_short_term_variability` (red) and `prolongued_decelerations` (red) contribute positively (SHAP values up to 4), reflecting patterns of instability and severe decelerations associated with hypoxia or acidosis. Features like `percentage_of_time_with_abnormal_long_term_variability` and `uterine_contractions` also play roles, with high values aligning with clinical indicators of Pathological states, such as increased stress from contractions or prolonged variability issues.

#### 3.2.3.4 Feature Selection and Clinical Relevance
Based on the SHAP summary plots, the least impactful 11 features were identified and dropped to streamline the model for clinical deployment, retaining the top 10 features: `histogram_mean`, `abnormal_short_term_variability`, `prolongued_decelerations`, `percentage_of_time_with_abnormal_long_term_variability`, `uterine_contractions`, `histogram_median`, `accelerations`, `histogram_mode`, `baseline value`, and `histogram_variance`. The dropped features—`fetal_movement`, `mean_value_of_short_term_variability`, `mean_value_of_long_term_variability`, `histogram_min`, `histogram_max`, `histogram_width`, `histogram_tendency`, `histogram_number_of_peaks`, `histogram_number_of_zeros`, `light_decelerations`, and `severe_decelerations`—exhibited low SHAP values across all classes, indicating minimal influence on predictions.

**Clinical Relevance of Retained Features**:
- `histogram_mean`: A high mean FHR strongly predicts the Pathological class, aligning with clinical guidelines (e.g., FIGO) that associate elevated FHR with fetal distress due to hypoxia [3].
- `abnormal_short_term_variability`: High values increase the likelihood of Suspect and Pathological classes, reflecting reduced variability as a marker of fetal compromise, often due to acidosis or neurological stress [3].
- `prolongued_decelerations`: Strongly predictive of the Pathological class, as prolonged decelerations indicate severe fetal hypoxia, often requiring immediate intervention [3].
- `percentage_of_time_with_abnormal_long_term_variability`: Impacts the Suspect and Pathological classes, as prolonged abnormal variability signals chronic stress or placental insufficiency [3].
- `uterine_contractions`: High frequency increases Pathological predictions, consistent with excessive contractions causing fetal stress [3].
- `histogram_median`, `histogram_mode`, `histogram_variance`: These FHR distribution metrics provide additional context on variability and stability, with deviations indicating potential distress.
- `accelerations`: High values predict Suspect states, reflecting fetal reactivity that may indicate early stress, though frequent accelerations can also be normal in some contexts [3].
- `baseline value`: Impacts all classes, as deviations from the normal FHR baseline (120–160 BPM) signal potential issues [3].

**Rationale for Dropping Features**:
The dropped features had negligible SHAP values, suggesting limited predictive power. For instance, `fetal_movement` showed low impact across all classes, likely because fetal movements are less directly tied to acute distress compared to FHR patterns [3]. Similarly, `mean_value_of_short_term_variability` and `mean_value_of_long_term_variability` were overshadowed by `abnormal_short_term_variability` and `percentage_of_time_with_abnormal_long_term_variability`, which capture more critical variability patterns. Features like `histogram_min`, `histogram_max`, and `histogram_width` describe the FHR histogram’s shape but are less informative than `histogram_mean` or `histogram_variance` for clinical decision-making. `histogram_tendency`, `histogram_number_of_peaks`, and `histogram_number_of_zeros` provide minor distributional details with limited diagnostic value. Finally, `light_decelerations` and `severe_decelerations` were less impactful than `prolongued_decelerations`, as the latter are more strongly associated with severe hypoxia [3]. Dropping these features reduces model complexity, minimizes overfitting, and focuses on clinically actionable variables, enhancing the model’s utility in real-world fetal health monitoring.

This SHAP-driven feature selection process ensures that the LightGBM model prioritizes features with the greatest clinical relevance, aligning predictions with established CTG diagnostic criteria and supporting its potential integration into clinical practice.

---

### References for This Section
- [1] Rahmayanti, N., Pradani, H., Pahlawan, M., & Vinarti, R. (2022). Comparison of machine learning algorithms to classify fetal health using cardiotocogram data. *Procedia Computer Science*, 197, 162–171.
- [2] Ke, G., Meng, Q., Finley, T., & Liu, T. Y. (2017). LightGBM: A highly efficient gradient boosting decision tree. *Advances in Neural Information Processing Systems*, 30, 3146–3154.
- [3] Ayres-De-Campos, D., Spong, C. Y., & Chandraharn, E. (2015). FIGO consensus guidelines on intrapartum fetal monitoring: Cardiotocography. *International Journal of Gynecology & Obstetrics*, 131, 13–24.

### Notes for Your Journal Paper
- **Figure Numbers**: Adjust "Figures 1a–c" to match your paper’s numbering (e.g., if this follows other figures, it might be "Figures 2a–c").
- **Figure Captions**: Add captions below each figure in your manuscript, e.g.:
  - Figure 1a: SHAP Summary Plot for Normal Class, showing feature impacts on prediction.
  - Figure 1b: SHAP Summary Plot for Suspect Class, highlighting key contributors.
  - Figure 1c: SHAP Summary Plot for Pathological Class, emphasizing clinical relevance.
- **References**: Ensure the references above are integrated into your paper’s reference list, maintaining consistent numbering.
- **Saving Plots**: Ensure the SHAP summary plots are saved (e.g., as `shap_summary_normal.png`, `shap_summary_suspect.png`, `shap_summary_pathological.png`) in your Colab “Files” tab for inclusion in the manuscript.

This section is now fully aligned with Q1 journal standards, providing a rigorous, interpretable, and clinically relevant analysis of the SHAP results and feature selection process. Let me know if you need further refinements or additional sections!
